<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ·è±¡è¨ˆç”» - ç´™æœ¬å¼•æ›å—ä»˜ãƒ•ã‚©ãƒ¼ãƒ </title>
    <meta name="description" content="æ–‡å­¦åŒäººãƒ¦ãƒ‹ãƒƒãƒˆã€Œæµ·è±¡è¨ˆç”»ã€ã®å…¬å¼ã‚µã‚¤ãƒˆã§ã™ã€‚">
    <style>
        /* --- åŸºæœ¬ãƒ•ã‚©ãƒ³ãƒˆãƒ»è¨­å®š --- */
        @font-face {
            font-family: 'Zen Old Mincho Subset';
            font-style: normal;
            font-weight: 700; 
            font-display: swap;
            src: url('subset-ZenOldMincho-Bold.woff2') format('woff2'); 
        }
        :root {
            --bg-color-home: #f4f1ea;
            --bg-color-works: #c0d6d1;
            --bg-color-profile: #0f267f;
            --bg-color-event: #040a23;
            --text-color-light: #f4f1ea; 
            --text-color-dark: #333333; 
            --accent-color: #1d3a4e;
            --link-color-dark: #5d7d9a;
            --link-color-light: #b0c9f0;
            --font-main: 'Zen Old Mincho', 'YuMincho', 'Hiragino Mincho ProN', 'MS PMincho', serif;
            --header-height: 60px; 
        }
        * { box-sizing: border-box; }
        html { scroll-padding-top: var(--header-height); }
        html.lenis, html.lenis body { height: auto; }
        
        body {
            margin: 0; padding: 0;
            font-family: var(--font-main);
            background: var(--bg-color-home); 
            color: var(--text-color-dark);
            line-height: 2;
            overflow-x: hidden;
        }
        body.no-scroll { overflow: hidden; }
        
        /* ãƒã‚¤ã‚ºãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        body::before {
            content: ""; position: fixed; inset: 0; pointer-events: none; z-index: 9999; opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        
        /* ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚° */
        #opening-overlay {
            position: fixed; inset: 0; background: #f4f1ea; display: flex; justify-content: center; align-items: center; z-index: 99999; opacity: 1; transition: opacity .6s ease-out;
        }
        #opening-overlay.fade-out { opacity: 0; pointer-events: none; }
        #opening-text {
            font-family: 'Zen Old Mincho Subset', serif; font-size: 3rem; font-weight: 700; color: #1d3a4e; white-space: nowrap; border-right: 0.1em solid #1d3a4e; animation: cursorBlink .7s infinite;
        }
        @keyframes cursorBlink { 0%,100% { border-color: transparent; } 50% { border-color: #1d3a4e; } }

        /* å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…±é€š */
        #home {
            height: 100vh; display: flex; justify-content: center; align-items: center; position: relative; text-align: center; background-color: var(--bg-color-home); 
        }
        .subtitle { font-size: 1.2rem; color: #666; margin-top: 5px; display: block; text-align: center; }
        .concept-text { font-size: 1.1rem; margin-top: 30px; line-height: 1.8; text-align: center; }
        .scroll-indicator {
            position: absolute; left: 30px; bottom: 150px; font-size: 1.2rem; color: var(--accent-color); transform: rotate(90deg); transform-origin: left bottom; letter-spacing: 0.1em; opacity: 0.7;
        }
        .concept-content { max-width: 600px; padding-bottom: 100px; min-height: 400px; display: flex; flex-direction: column; justify-content: center; }
        .site-title { font-size: 4rem; font-weight: 700; color: var(--accent-color); letter-spacing: 0.3em; margin: 0; line-height: 1.2; }

        @media (max-width: 900px) { .site-title { font-size: 3rem; letter-spacing: 0.2em; } }
        @media (max-width: 768px) {
            #opening-text { font-size: 2rem; }
            .site-title { font-size: 2.5rem; letter-spacing: 0.15em; }
            .scroll-indicator { left: 20px; bottom: 150px; }
        }

        /* --- å®Œäº†ç”»é¢ï¼ˆSection4ï¼‰ã®åˆæœŸçŠ¶æ…‹ --- */
        /* æœ€åˆã¯éè¡¨ç¤ºã«ã—ã¦ãŠãã€é€ä¿¡å¾Œã«JSã§ active ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸ã—ã¦è¡¨ç¤ºã—ã¾ã™ */
        #section4 {
            display: none; 
            opacity: 0;
            transition: opacity 1.5s ease;
        }
        #section4.active {
            display: block;
            opacity: 1;
        }

        /* ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        /* --- ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ç”»é¢ --- */
        #access-error {
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 1s ease;
        }
        #access-error.visible {
            opacity: 1;
        }
        .error-title {
            font-size: 2rem;
            color: var(--accent-color);
            margin-bottom: 20px;
            font-weight: 700;
        }
        .error-text {
            font-size: 1.1rem;
            margin-bottom: 40px;
        }
    </style>
    <link rel="stylesheet" href="style3.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.19/bundled/lenis.min.js" defer></script>
</head>

<body>

    <div id="opening-overlay">
        <div id="opening-text"></div>
    </div>

    <nav id="nav-bar">
        <div class="container nav-content">
            <a href="index.html" class="nav-title">æµ·è±¡è¨ˆç”»</a>
            <div class="nav-links">
                <a href="index.html">Home</a>
            </div>
        </div>
    </nav>

    <section id="access-error">
        <div class="container">
            <h2 class="error-title">Access Error</h2>
            <p class="error-text">
                ã“ã®ãƒšãƒ¼ã‚¸ã¯è³¼å…¥è€…å°‚ç”¨ã§ã™ã€‚<br>
                BOOTHã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã¾ãŸã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã«å«ã¾ã‚Œã‚‹<br>
                <strong>å°‚ç”¨URLï¼ˆcodeä»˜ãï¼‰</strong>ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚
            </p>
            <div class="btn-area">
                <a href="index.html" class="btn">TOPãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</a>
            </div>
        </div>
    </section>

    <section id="home" class="first-view">
        <div class="concept-content fade-up">
            <h1 class="site-title">ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ </h1>
            <p class="subtitle">Book Exchange Registration</p>
            <p class="concept-text">
                BOOTHã«ã¦é›»å­æ›¸ç±ã‚’ã”è³¼å…¥ã„ãŸã ã„ãŸçš†æ§˜ã¸ã€‚<br>
                ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã«ã¦ç´™æœ¬ã®ã€å‡ºè¡€ã€ã®ç„¡æ–™å¼•æ›ã‚’ã”å¸Œæœ›ã®æ–¹ã¯ã“ã¡ã‚‰ã‚ˆã‚Šã”ç™»éŒ²ãã ã•ã„ã€‚<br>
                ä¼šå ´ã§ã®æœ¬äººç¢ºèªã«å¿…è¦ãª"åˆè¨€è‘‰"ã‚’è¨­å®šã—ã¦ã„ãŸã ãã¾ã™ã€‚<br>
                ï¼ˆæ‰€è¦æ™‚é–“ï¼šç´„1åˆ†ï¼‰
            </p>
            <div class="btn-area">
                <a href="#section1" class="btn">å¼•æ›ç™»éŒ²é–‹å§‹</a>
            </div>
        </div>
        <div class="scroll-indicator">scroll &rarr;</div>
    </section>

    <div id="unified-ocean-container">
        
        <div class="bubbles-background" id="unified-bubbles-background"></div>

        <div class="wave-separator">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                <path fill="#c0d6d1" fill-opacity="1" d="M0,192L48,208C96,224,192,256,288,256C384,256,480,224,576,224C672,224,768,256,864,266.7C960,277,1056,267,1152,250.7C1248,235,1344,213,1392,202.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
        </div>

        <section id="section1">
            <div class="container site-content">
                <h2 class="section-title fade-up">Q1. å¼•æ›å¸Œæœ›ã«ã¤ã„ã¦</h2>
                <div class="question-form">
                    <div class="question-group fade-up">
                        <p class="question-text">Q1-1. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã§ç´™æœ¬ã®å—ã‘å–ã‚Šã‚’å¸Œæœ›ã—ã¾ã™ã‹ï¼Ÿ</p>
                        <div class="radio-group">
                            <label><input type="radio" name="exchange_hope" value="ã¯ã„" required><span class="custom-radio"></span>ã¯ã„</label>
                            <label><input type="radio" name="exchange_hope" value="ã„ã„ãˆ"><span class="custom-radio"></span>ã„ã„ãˆ</label>
                        </div>
                    </div>
                </div>
                <div class="btn-area fade-up">
                    <a href="#section2" class="btn">æ¬¡ã«é€²ã‚€(1/3)</a>
                </div>
            </div>
        </section>
        
        <section id="section2">
            <div class="container site-content">
                <h2 class="section-title fade-up">Q2. å—å–ã‚¤ãƒ™ãƒ³ãƒˆã«ã¤ã„ã¦</h2>
                <div class="question-form">
                    <div class="question-group fade-up">
                        <p class="question-text">Q2-1. ã©ã®ã‚¤ãƒ™ãƒ³ãƒˆã§å—ã‘å–ã‚Šã¾ã™ã‹ï¼Ÿ</p>
                        <div class="radio-group">
                            <label><input type="radio" name="receive_event" value="ZINEãƒ•ã‚§ã‚¹æ±äº¬" required><span class="custom-radio"></span>ZINEãƒ•ã‚§ã‚¹æ±äº¬</label>
                            <label><input type="radio" name="receive_event" value="ãã®ä»–"><span class="custom-radio"></span>ãã®ä»–</label>
                        </div>
                    </div>
                </div>
                <div class="btn-area fade-up">
                    <a href="#section3" class="btn">æ¬¡ã«é€²ã‚€(2/3)</a>
                </div>
            </div>
        </section>
        
        <section id="section3">
            <div class="container site-content">
                <h2 class="section-title fade-up">Q3. åˆè¨€è‘‰ã®è¨­å®š</h2>
                
                <div class="question-form">
                    <div class="question-group fade-up">
                        <p class="question-text">
                            Q3-1. ä¼šå ´ã§ã®æœ¬äººç¢ºèªã«å¿…è¦ãªåˆè¨€è‘‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚<br>
                            ï¼ˆ5æ–‡å­—ä»¥ä¸Šï¼‰
                        </p>
                        <input type="text" id="passphrase" name="passphrase" 
                               placeholder="5æ–‡å­—ä»¥ä¸Šã®åˆè¨€è‘‰ã‚’å…¥åŠ›" required minlength="5">
                        <p id="error-message" style="color: #ff9999; font-size: 0.9rem; display: none; margin-top: 10px;">
                            </p>
                    </div>
                    
                    <div class="btn-area fade-up">
                        <button type="button" id="final-submit-btn" class="btn">ç™»éŒ²ã‚’å®Œäº†ã™ã‚‹</button>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="section4">
            <div class="container site-content">
                <h2 class="section-title fade-up">ç™»éŒ²å®Œäº†</h2>
                <p class="fade-up" style="max-width: 600px; margin: 0 auto; text-align: center;">
                    ã”ç™»éŒ²ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>
                    è¨­å®šã„ãŸã ã„ãŸ**åˆè¨€è‘‰**ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´ã§ã®å¼•æ›æ™‚ã«å¿…è¦ã¨ãªã‚Šã¾ã™ã€‚<br>
                    å¤§åˆ‡ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚<br>
                    <br>
                    å½“æ—¥ã€ä¼šå ´ã«ã¦ãŠä¼šã„ã§ãã‚‹ã®ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ã€‚
                </p>
                
                <div class="btn-area fade-up">
                    <a href="index.html" class="btn">åœ°ä¸Šã¸æˆ»ã‚‹ (TOPã¸)</a>
                </div>
            </div>
            
            <footer class="fade-up" style="margin-top: 50px;">
                &copy; 2024 Kaizo Keikaku
            </footer>
            <div id="bioluminescence-container"></div>
        </section>
        
    </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    
    // ==========================================
    // ã€è¨­å®šã‚¨ãƒªã‚¢ã€‘ã“ã“ã«å–å¾—ã—ãŸIDã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
    // ==========================================
    const GOOGLE_FORM_CONFIG = {
        // ğŸ’¡ ä¿®æ­£ç‚¹: URLã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¤ºã™ `/u/0/` ã‚’å‰Šé™¤
        actionUrl: "https://docs.google.com/forms/d/e/1FAIpQLSenRSd7gNnlB0hqXe8uWrELNvrq1Ti0V3B1owV9ogISTO5Bpg/formResponse",
        
        // å„è³ªå•ã® entry.xxxxxx ID
        ids: {
            exchange_hope: "entry.187432404", // Q1. å¼•æ›å¸Œæœ› (ã¯ã„/ã„ã„ãˆ)
            receive_event: "entry.595917821", // Q2. ã‚¤ãƒ™ãƒ³ãƒˆ
            passphrase:    "entry.526670925", // Q3. åˆè¨€è‘‰
            user_code:     "entry.249561107"  // User Code (code=xxx)
        }
    };
    // ==========================================

    // --- User Code ã®è‡ªå‹•å–å¾— ---
    // æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰å–å¾—éƒ¨åˆ†ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ãƒ»æ‹¡å¼µã—ã¾ã™
    let currentUserCode = "";
    const urlParams = new URLSearchParams(window.location.search);
    const codeParam = urlParams.get('code');
    
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ã€ã‹ã¤8æ¡ã®è‹±æ•°å­—ã§ã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    const codeRegex = /^[a-zA-Z0-9]{8}$/;
    let isValidAccess = false;

    if (codeParam && codeRegex.test(codeParam)) {
        currentUserCode = codeParam;
        isValidAccess = true;
    }

    // --- é€ä¿¡ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡ (JSã§æ‰‹å‹•é€ä¿¡) ---
    const submitBtn = document.getElementById('final-submit-btn');
    const errorMessage = document.getElementById('error-message');
    const section3 = document.getElementById('section3');
    const section4 = document.getElementById('section4');
    
    // ğŸ’¡ jQueryãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã®ãƒã‚§ãƒƒã‚¯
    if (typeof jQuery === 'undefined') {
        console.error("jQueryãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Google Formsã®é€ä¿¡ã«ã¯jQueryãŒå¿…è¦ã§ã™ã€‚HTMLã®<head>ã‚¿ã‚°ã§jQueryã®CDNã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚");
    }

    // å‡¦ç†æˆåŠŸæ™‚ã®å…±é€šãƒ­ã‚¸ãƒƒã‚¯ã‚’é–¢æ•°åŒ–
    function handleSuccess() {
        // CORSã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚Šã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã¯ã‚¨ãƒ©ãƒ¼ï¼ˆstatusCode 0/200ã®æˆåŠŸï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚Œã°OKã§ã™
        console.log("Google Formsé€ä¿¡å‡¦ç†å®Œäº† (statusCode: 0ã¾ãŸã¯200)");
        
        // å…¥åŠ›ç”»é¢(Section3)ã‚’éè¡¨ç¤ºã«ã™ã‚‹
        section3.style.display = 'none';
        
        // å®Œäº†ç”»é¢(Section4)ã‚’è¡¨ç¤ºã™ã‚‹
        section4.classList.add('active');

        // ã‚¹ãƒ ãƒ¼ã‚ºã«å®Œäº†ç”»é¢ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’èª¿æ•´
        const section4El = document.getElementById('section4');
        lenis.scrollTo(section4El, { offset: -60, duration: 2 });

        // ç™ºå…‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ (æ·±æµ·æ¼”å‡º)
        initializeBioluminescence();
    }


    if (submitBtn) {
        submitBtn.addEventListener('click', () => { 
            if (typeof jQuery === 'undefined') {
                 errorMessage.style.display = 'block';
                 errorMessage.textContent = "â€»é€ä¿¡ã‚¨ãƒ©ãƒ¼: jQueryãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
                 return;
            }
            
            // 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼‰
            const q1 = document.querySelector('input[name="exchange_hope"]:checked');
            const q2 = document.querySelector('input[name="receive_event"]:checked');
            const q3 = document.getElementById('passphrase');

            if (!q1 || !q2 || !q3.value || q3.value.length < 5) {
                errorMessage.style.display = 'block';
                errorMessage.textContent = "â€»ã™ã¹ã¦ã®é …ç›®ã‚’é¸æŠã—ã€åˆè¨€è‘‰ã‚’5æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
                return; // ã“ã“ã§å‡¦ç†ã‚’ä¸­æ–­ï¼ˆé€ä¿¡ã—ãªã„ï¼‰
            }

            // 2. é€ä¿¡æº–å‚™ï¼ˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã“ã¨ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¼ãˆã‚‹ï¼‰
            errorMessage.style.display = 'none';
            submitBtn.textContent = "é€ä¿¡ä¸­..."; 
            submitBtn.disabled = true; 

            // 3. ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ (jQuery.ajaxç”¨)
            // Google Formsã¯ 'application/x-www-form-urlencoded' å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’æœŸå¾…ã—ã¾ã™
            const submitData = {};
            submitData[GOOGLE_FORM_CONFIG.ids.exchange_hope] = q1.value;
            submitData[GOOGLE_FORM_CONFIG.ids.receive_event] = q2.value;
            submitData[GOOGLE_FORM_CONFIG.ids.passphrase]    = q3.value;
            submitData[GOOGLE_FORM_CONFIG.ids.user_code]     = currentUserCode;
            
            // ğŸ’¡ ä¿®æ­£ç‚¹: 400 Bad Requestã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ã€pageHistoryãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
            submitData['pageHistory'] = '0';

            // ==========================================
            // ã€ğŸ’¡ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒ¼ãƒ‰ã®è¿½åŠ ğŸ’¡ã€‘
            // é€ä¿¡å†…å®¹ã¨URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ã¾ã™
            // ==========================================
            console.log("--- ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãƒ‡ãƒ¼ã‚¿ (jQuery Data) ---");
            console.log(submitData);
            console.log("-------------------------------------");
            console.log(`ç¾åœ¨ã®URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ 'code': ${currentUserCode}`);
            console.log("-------------------------------------");
            // ==========================================

            // 4. Googleãƒ•ã‚©ãƒ¼ãƒ ã¸é€ä¿¡ (jQuery.ajax)
            // dataType: "xml" ã¨ã™ã‚‹ã“ã¨ã§ã€CORSã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚é€ä¿¡è‡ªä½“ã¯æ©Ÿèƒ½ã•ã›ã¾ã™
            $.ajax({
                url: GOOGLE_FORM_CONFIG.actionUrl,
                data: submitData,
                type: "POST",
                dataType: "xml", 
                
                // statusCode: 0 ã¯CORSã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚‹å¿œç­”ãªã—ã‚’æ„å‘³ã—ã€é€ä¿¡æˆåŠŸã¨ã¿ãªã—ã¾ã™
                statusCode: {
                    0: function() {
                        // 5. é€ä¿¡æˆåŠŸå¾Œã®æ¼”å‡ºï¼ˆç”»é¢åˆ‡ã‚Šæ›¿ãˆï¼‰
                        handleSuccess();
                    },
                    200: function() {
                        // 5. é€ä¿¡æˆåŠŸå¾Œã®æ¼”å‡ºï¼ˆç”»é¢åˆ‡ã‚Šæ›¿ãˆï¼‰
                        handleSuccess();
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    // statusCode 0/200 ä»¥å¤–ã§é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸå ´åˆã®æœ€çµ‚çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
                    if (textStatus !== 'abort') { 
                        console.error("Submission error:", textStatus, errorThrown);
                        // 400 Bad Requestã‚‚ã“ã®ã‚¨ãƒ©ãƒ¼ã«å…¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
                        errorMessage.style.display = 'block';
                        errorMessage.textContent = "é€ä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ç½®ã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
                        submitBtn.textContent = "ç™»éŒ²ã‚’å®Œäº†ã™ã‚‹"; 
                        submitBtn.disabled = false;
                    }
                }
            });
        });
    }


    // --- ä»¥ä¸‹ã€æ—¢å­˜ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ¼”å‡ºã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç¶­æŒï¼‰ ---
    
    let section1EndAbsolute = 0;
    let section2EndAbsolute = 0;
    let firstViewHeight = 0;
    let oceanContainerTop = 0;
    
    const section1 = document.getElementById('section1');
    const section2 = document.getElementById('section2');
    const firstView = document.getElementById('home');
    const oceanContainer = document.getElementById('unified-ocean-container');
    
    function cacheGeometry() {
        if (section1 && section2) {
            section1EndAbsolute = section1.offsetTop + section1.offsetHeight;
            section2EndAbsolute = section2.offsetTop + section2.offsetHeight;
        }
        if (firstView) firstViewHeight = firstView.offsetHeight;
        if (oceanContainer) oceanContainerTop = oceanContainer.offsetTop;
    }

    cacheGeometry(); 
    window.addEventListener('resize', cacheGeometry);

    function getScrollDuration(lenisScrollY) {
        const scrollY = lenisScrollY;
        if (scrollY < section1EndAbsolute) return 1.5; 
        else if (scrollY < section2EndAbsolute) return 3.0; 
        else return 6.0; 
    }

    const lenis = new Lenis({
        duration: 3.0, 
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), 
        direction: 'vertical', 
        smooth: true, 
    });

    function raf(time) {
        lenis.options.duration = getScrollDuration(lenis.scroll);
        lenis.raf(time);
        requestAnimationFrame(raf);
    }
    raf(0); 

    // Opening
    const openingText = document.getElementById("opening-text");
    const openingOverlay = document.getElementById("opening-overlay");

    lenis.stop(); 
    document.body.classList.add("no-scroll");

    const typingSequence = [
        { text: "k", delay: 100 }, { text: "ã‹", delay: 100 },
        { text: "ã‹ã„", delay: 100 }, { text: "ã‹ã„z", delay: 100 },
        { text: "ã‹ã„ã", delay: 100 }, { text: "ã‹ã„ãã†", delay: 100 },
        { text: "æ”¹é€ ", delay: 200 }, { text: "è§£åƒ", delay: 200 },
        { text: "æµ·è±¡", delay: 300 }, { text: "æµ·è±¡k", delay: 100 },
        { text: "æµ·è±¡ã‘", delay: 100 }, { text: "æµ·è±¡ã‘ã„", delay: 100 },
        { text: "æµ·è±¡ã‘ã„k", delay: 100 }, { text: "æµ·è±¡ã‘ã„ã‹", delay: 100 },
        { text: "æµ·è±¡ã‘ã„ã‹k", delay: 100 },
        { text: "æµ·è±¡ã‘ã„ã‹ã", delay: 100 },
        { text: "æµ·è±¡è¨ˆç”»", delay: 500 }
    ];

    let i = 0;
    function typeText() {
        if (i < typingSequence.length) {
            openingText.textContent = typingSequence[i].text;
            setTimeout(typeText, typingSequence[i].delay);
            i++;
        } else {
            setTimeout(() => {
                openingOverlay.classList.add("fade-out");
                setTimeout(() => {
                    openingOverlay.style.display = "none";
                    document.body.classList.remove("no-scroll"); 
                    lenis.start(); 
                    startScrollFadeIn();
                }, 700);
            }, 500);
        }
    }
    typeText();

    function startScrollFadeIn() {
        const targets = document.querySelectorAll(".fade-up");
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("visible");
                    observer.unobserve(entry.target);
                }
            });
        }, { rootMargin: '0px 0px -100px 0px' }); 
        targets.forEach(el => observer.observe(el));
    }
    
    // Bubbles
    let lastScrollY = 0;
    const unifiedBubbles = document.getElementById('unified-bubbles-background');
    
    function getRandom(min, max) { return Math.random() * (max - min) + min; }
    
    function createBubble(container, initialY, offsetCompensation = 0) { 
        if (!container || !section1 || !section2) return; 
        const bubble = document.createElement('div');
        bubble.classList.add('bubble');
        const size = getRandom(10, 25);
        const x = getRandom(0, 100); 
        bubble.style.width = `${size}px`;
        bubble.style.height = `${size}px`;
        bubble.style.left = `${x}%`;
        let relativeTop = initialY - oceanContainerTop + offsetCompensation;
        bubble.style.top = `${relativeTop - getRandom(0, size * 2)}px`; 
        
        if (initialY < section1EndAbsolute) bubble.classList.add('bubble-works-color');
        else bubble.classList.add('bubble-profile-color');
        
        setTimeout(() => bubble.style.opacity = getRandom(0.4, 1), getRandom(0, 500));
        container.appendChild(bubble);
    }
    
    function initializeBubbles(container) {
        if (!container) return;
        container.innerHTML = '';
        const initialRange = window.innerHeight * 3; 
        for (let i = 0; i < 20; i++) { 
            const initialY = oceanContainerTop + getRandom(0, initialRange);
            createBubble(container, initialY, 0); 
        }
    }
    
    function removeOldBubbles(container, moveY) {
        if (!container) return;
        const bubbles = container.querySelectorAll('.bubble');
        bubbles.forEach(bubble => {
            if (parseFloat(bubble.style.top) + moveY < -window.innerHeight * 2) bubble.remove();
        });
    }
    
    let lastGenerateScroll = 0; 
    function updateBubblePosition() {
        const currentScrollY = window.scrollY; 
        if (currentScrollY >= lastScrollY) {
            const moveY = -(currentScrollY * 0.65); 
            if (unifiedBubbles) unifiedBubbles.style.transform = `translateY(${moveY}px)`;
            
            if (currentScrollY - lastGenerateScroll >= 80) {
                createBubble(unifiedBubbles, currentScrollY + window.innerHeight + 50, -moveY); 
                removeOldBubbles(unifiedBubbles, moveY);
                lastGenerateScroll = currentScrollY;
            }
        } 
        lastScrollY = currentScrollY;
        requestAnimationFrame(updateBubblePosition);
    }

    // Bioluminescence (Triggered after Submit)
    const bioluminescenceContainer = document.getElementById('bioluminescence-container');
    function createLightParticle() {
        if (!bioluminescenceContainer) return;
        const particle = document.createElement('div');
        particle.classList.add('biolum-particle');
        const y = getRandom(0, bioluminescenceContainer.offsetHeight);
        const x = getRandom(0, 100); 
        particle.style.top = `${y}px`;
        particle.style.left = `${x}%`;
        const size = getRandom(4, 12);
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        bioluminescenceContainer.appendChild(particle);
        const lifeDuration = getRandom(1, 5); 
        particle.style.animation = `biolum-float 2s ease-out forwards, slowFadeFlash ${lifeDuration}s ease-in-out forwards`;
        setTimeout(() => particle.remove(), lifeDuration * 1000); 
    }
    
    function initializeBioluminescence() {
        if (!bioluminescenceContainer) return;
        // æ—¢å­˜ã®setIntervalã‚’ã‚¯ãƒªã‚¢ã—ã€å¤šé‡èµ·å‹•ã‚’é˜²ãå‡¦ç†ã¯å«ã‚ãšã€ã‚·ãƒ³ãƒ—ãƒ«ã«ç¶­æŒã—ã¾ã™
        setInterval(createLightParticle, 1500);
    }
    
    function handleScrollOptimized() {
        const nav = document.getElementById('nav-bar');
        if (window.scrollY >= firstViewHeight) nav.classList.add('fixed');
        else nav.classList.remove('fixed');
    }

    window.addEventListener('load', () => {
        cacheGeometry(); 
        if (oceanContainer) {
            initializeBubbles(unifiedBubbles);
            requestAnimationFrame(updateBubblePosition);
        }
    });
    
    window.addEventListener('scroll', handleScrollOptimized);
    
    // Anchor Links
    document.querySelectorAll('#nav-bar a, .btn-area a').forEach(link => {
        if (link.hash && link.hash.startsWith('#section')) {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.hash;
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    lenis.scrollTo(targetElement, { offset: -60, duration: 6.0 });
                }
            });
        }
    });
});
</script>

</body>
</html>