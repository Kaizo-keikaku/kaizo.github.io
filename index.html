<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海象計画</title>
    <meta name="description" content="文学同人サークル「海象計画」の公式サイト。">
    <meta property="og:title" content="海象計画">
    <meta property="og:description" content="静謐な海を漂うような、言葉の記録。">
    <meta property="og:url" content="https://kaizo-keikaku.github.io/">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2250%%22 y=%2250%%22 style=%22dominant-baseline:central;text-anchor:middle;font-size:90px;%22>🌊</text></svg>">
</head>

<body>

    <div id="opening-overlay">
        <div id="opening-text"></div>
    </div>

    <nav id="nav-bar">
        <div class="container nav-content">
            <a href="#home" class="nav-title">海象計画</a>
            <div class="nav-links">
                <a href="#works">Works</a>
                <a href="#profile">Profile</a>
            </div>
        </div>
    </nav>

    <section id="home" class="first-view">
        <div class="concept-content fade-up">
            <h1 class="site-title">海象計画</h1>
            <p class="subtitle">Walrus Project</p>
            <p class="concept-text">
                静謐な海を漂うような、言葉の記録。<br>
                言葉の海を泳ぐ、緩やかな計画。
            </p>
        </div>
        <div class="scroll-indicator">scroll &rarr;</div>
    </section>

    <div class="wave-separator">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
            <path fill="#c0d6d1" fill-opacity="1" d="M0,192L48,208C96,224,192,256,288,256C384,256,480,224,576,224C672,224,768,256,864,266.7C960,277,1056,267,1152,250.7C1248,235,1344,213,1392,202.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
        </svg>
    </div>

    <div id="deep-sea-area">
        
        <div class="bubbles-background" id="combined-bubbles-background"></div>

        <section id="works">
            <div class="container site-content">
                <h2 class="section-title fade-up">作品一覧 (Works)</h2>

                <ul class="work-list">
                    <li class="work-item fade-up layout-left">
                        <div class="work-media">
                            <a class="work-image-trigger" data-target="modal-work01">
                                <img src="https://via.placeholder.com/300x400?text=Work+01+Cover" alt="『海辺の冬支度』表紙" loading="lazy">
                            </a>
                        </div>
                        <div class="work-info">
                            <span class="work-date">2024.11.26</span>
                            <a class="work-trigger" data-target="modal-work01">『海辺の冬支度』</a>
                            <p class="description">文芸フリマにて頒布した短編集。静かな波音と生活の記録。</p>
                            <a href="#" class="btn btn-small">詳細・購入</a>
                        </div>
                    </li>

                    <li class="work-item fade-up layout-right">
                        <div class="work-media">
                            <a class="work-image-trigger" data-target="modal-work02">
                                <img src="https://via.placeholder.com/300x400?text=Work+02+Cover" alt="『漂流する活字』表紙" loading="lazy">
                            </a>
                        </div>
                        <div class="work-info">
                            <span class="work-date">2024.05.20</span>
                            <a class="work-trigger" data-target="modal-work02">『漂流する活字』</a>
                            <p class="description">初期作品のアンソロジー。現在は頒布を終了しています。</p>
                        </div>
                    </li>
                </ul>
            </div>
        </section>
        
        <section id="profile">
            <div class="container site-content">
                <h2 class="section-title fade-up">海象計画について (Profile)</h2>
                <p class="fade-up">
                    文学同人サークル「海象計画」は、言葉と静けさの探求をテーマに活動しています。
                </p>

                <div class="member-list">
                    <div class="member-item fade-up">
                        <h3 class="member-name">催花亮太 (Saika Ryota)</h3>
                        <p class="member-description">
                            主に散文や詩を執筆。海と冬の情景を愛し、孤独と記憶をテーマに据えることが多い。
                            静かな筆致で、日常に潜む微かな機微を捉えることを信条としている。
                        </p>
                    </div>
                    <div class="member-item fade-up">
                        <h3 class="member-name">榎田ブショネ (Enokida Bushone)</h3>
                        <p class="member-description">
                            物語や批評を担当。『白痴ゅうむ』のような、人間の内面の葛藤や不理解への苛立ちをグロテスクに描く作風が特徴的。
                            現実の輪郭を曖昧にするような、実験的な表現を追求している。
                        </p>
                    </div>
                </div>

                <h3 class="fade-up sns-title">各種SNS</h3>
                <div class="btn-area fade-up">
                    <a href="https://x.com/katsupan_hanto" target="_blank" class="btn">
                        X (Twitter)
                    </a>
                    <a href="#" target="_blank" class="btn">
                        Note
                    </a>
                </div>

                <div class="btn-area fade-up">
                    <a href="https://twitter.com/intent/tweet?text=文学同人サークル%20海象計画%20公式サイト&url=https://kaizo-keikaku.github.io/" target="_blank" class="btn btn-share">
                        X で共有する
                    </a>
                </div>

                <footer class="fade-up">
                    &copy; 2024 Kaizo Keikaku
                </footer>
            </div>
        </section>
    </div> <div id="modal-work01" class="modal-overlay" style="--modal-bg: #1d3a4e; --modal-text: #f4f1ea;">
        <button class="close-modal-btn">×</button>
        <div class="modal-content">
            <span class="work-date">2024.11.26 発行</span>
            <h2 style="border-left-color: #fff; margin-top:0;">海辺の冬支度</h2>
            <p class="modal-spec">
                <strong>仕様：</strong> 文庫サイズ / 120ページ / 800円<br>
                <strong>著者：</strong> 海象計画
            </p>
            <p class="modal-text">
                【あらすじ】<br>
                古い灯台の近くに住む男と、言葉を失った少女のひと冬の物語。<br>
                厳しい寒さの中で交わされる、温かいスープと断片的な記憶。
            </p>
            <div class="btn-area">
                <a href="#" class="btn" style="border-color:currentColor; color:currentColor;">BOOTHで購入</a>
            </div>
        </div>
    </div>

    <div id="modal-work02" class="modal-overlay" style="--modal-bg: #3e2b2b; --modal-text: #e6e0d5;">
        <button class="close-modal-btn">×</button>
        <div class="modal-content">
            <span class="work-date">2024.05.20 発行</span>
            <h2 style="border-left-color: #e6e0d5; margin-top:0;">漂流する活字</h2>
            <p class="modal-spec">
                <strong>仕様：</strong> A5サイズ / 40ページ / 頒布終了<br>
            </p>
            <p class="modal-text">
                【概要】<br>
                初期の習作を集めたアンソロジー。<br>
                今はもう手に入らない、断片的な思考の記録。
            </p>
        </div>
    </div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const openingText = document.getElementById("opening-text");
    const openingOverlay = document.getElementById("opening-overlay");

    const typingSequence = [
        { text: "k", delay: 100 }, { text: "か", delay: 100 },
        { text: "かい", delay: 100 }, { text: "かいz", delay: 100 },
        { text: "かいぞ", delay: 100 }, { text: "かいぞう", delay: 100 },
        { text: "改造", delay: 200 }, { text: "解像", delay: 200 },
        { text: "海象", delay: 300 }, { text: "海象k", delay: 100 },
        { text: "海象け", delay: 100 }, { text: "海象けい", delay: 100 },
        { text: "海象けいk", delay: 100 }, { text: "海象けいか", delay: 100 },
        { text: "海象けいかk", delay: 100 },
        { text: "海象けいかく", delay: 100 },
        { text: "海象計画", delay: 500 }
    ];

    let i = 0;

    function typeText() {
        if (i < typingSequence.length) {
            openingText.textContent = typingSequence[i].text;
            setTimeout(typeText, typingSequence[i].delay);
            i++;
        } else {
            setTimeout(() => {
                openingOverlay.classList.add("fade-out");
                // フェードアウト完了後、bodyにno-scrollクラスを追加
                document.body.classList.add("no-scroll");
                setTimeout(() => {
                    openingOverlay.style.display = "none";
                    document.body.classList.remove("no-scroll"); // スクロール禁止を解除
                    startScrollFadeIn();
                }, 700);
            }, 1000);
        }
    }

    typeText();

    // スクロールフェードイン
    function startScrollFadeIn() {
        const targets = document.querySelectorAll(".fade-up");

        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("visible");
                    observer.unobserve(entry.target);
                }
            });
        }, { rootMargin: '0px 0px -100px 0px' }); // ビューポートの下端から100px手前で発火

        targets.forEach(el => observer.observe(el));
    }
    
    // --- 【修正・追加した処理：泡の動的生成とスクロール制御】 ---
    
    let lastScrollY = 0;
    const deepSeaArea = document.getElementById('deep-sea-area'); // 新しい親コンテナ
    const worksSection = document.getElementById('works');
    const profileSection = document.getElementById('profile');
    const combinedBubbles = document.getElementById('combined-bubbles-background'); // 統合された泡コンテナ
    
    const BUBBLE_COUNT = 30; // 常に各セクションに存在する泡の目標数
    const BUBBLE_SPEED_MULTIPLIER = 1.5; // スクロール速度の1.5倍
    const BUBBLE_SIZE_MIN = 40; // 最小直径 (px)
    const BUBBLE_SIZE_MAX = 100; // 最大直径 (px)
    const GENERATE_THRESHOLD = 50; // 50pxスクロールごとに新しい泡をチェック

    let lastGenerateScroll = 0; // 最後に泡を生成したスクロール位置

    function getRandom(min, max) {
        return Math.random() * (max - min) + min;
    }
    
    /**
     * 新しい泡要素を生成し、ランダムな位置とサイズでDOMに追加する
     */
    function createBubble(container, wrapperHeight, spawnY) {
        const bubble = document.createElement('div');
        bubble.classList.add('bubble');
        
        const size = getRandom(BUBBLE_SIZE_MIN, BUBBLE_SIZE_MAX);
        const x = getRandom(0, 100); // 0%から100%
        
        bubble.style.width = `${size}px`;
        bubble.style.height = `${size}px`;
        bubble.style.left = `${x}%`;
        // スクロール時の現在位置 + 補正を加えたトップ位置
        bubble.style.top = `${spawnY}px`; 
        
        // ランダムな時間差でフェードイン
        setTimeout(() => {
            bubble.style.opacity = getRandom(0.4, 1);
        }, getRandom(0, 500));
        
        container.appendChild(bubble);
    }
    
    /**
     * 指定されたコンテナ内に泡を初期生成・配置する関数
     */
    function initializeBubbles(container, wrapper) {
        if (!container || !wrapper) return;
        container.innerHTML = '';
        
        // 泡の初期配置範囲 (Wrapperの高さ)
        const wrapperHeight = wrapper.offsetHeight; 

        for (let i = 0; i < BUBBLE_COUNT; i++) {
            const bubble = document.createElement('div');
            bubble.classList.add('bubble');
            
            const size = getRandom(BUBBLE_SIZE_MIN, BUBBLE_SIZE_MAX);
            const x = getRandom(0, 100); 
            // Wrapperの高さの範囲でランダムなY座標に初期配置
            const y = getRandom(0, wrapperHeight); 
            
            bubble.style.width = `${size}px`;
            bubble.style.height = `${size}px`;
            bubble.style.left = `${x}%`;
            bubble.style.top = `${y}px`; 
            
            // ランダムな時間差でフェードイン
            setTimeout(() => {
                bubble.style.opacity = getRandom(0.4, 1);
            }, getRandom(0, 500));
            
            container.appendChild(bubble);
        }
    }
    
    /**
     * 画面外の上部に出た古い泡を削除する (安全策)
     */
    function removeOldBubbles(container) {
        if (!container) return;

        const bubbles = container.querySelectorAll('.bubble');
        if (bubbles.length > BUBBLE_COUNT * 2) { 
            // 制限数を超えたら、最も古い泡を削除
            // 泡はFIFOキューとして扱われるため、インデックス0から削除
            for (let i = 0; i < bubbles.length - BUBBLE_COUNT; i++) {
                bubbles[i].remove(); 
            }
        }
    }
    
    // スクロール時の背景移動処理
    function handleBubbleScroll() {
        const currentScrollY = window.scrollY;
        
        // deepSeaAreaの開始位置
        const areaStartOffset = deepSeaArea.offsetTop;
        // deepSeaAreaの終了位置 (画面外に出るまで)
        const areaEndOffset = areaStartOffset + deepSeaArea.offsetHeight;

        // deepSeaAreaの範囲内、またはその手前でスクロールダウンしている場合に処理を実行
        if (currentScrollY >= areaStartOffset) {
            
            // ドキュメントトップからのスクロール距離を基準に移動量を計算
            const moveY = -(currentScrollY * BUBBLE_SPEED_MULTIPLIER); 
            
            // 泡コンテナを動かす
            if (combinedBubbles) {
                combinedBubbles.style.transform = `translateY(${moveY}px)`;
            }
            
            // --- 【新規】ランダム生成のロジック ---
            const scrollDistanceSinceLastGenerate = currentScrollY - lastGenerateScroll;

            // deepSeaAreaが表示されている場合に生成
            // areaEndOffset + window.innerHeight は、セクションが画面から完全に消えるまで生成を続けるための余裕
            if (currentScrollY < areaEndOffset + window.innerHeight) { 
                
                if (currentScrollY > lastScrollY && scrollDistanceSinceLastGenerate >= GENERATE_THRESHOLD) {
                    
                    // 泡コンテナ内のY座標を計算
                    // (現在のスクロール位置 + 画面の高さ) はドキュメント上のビューポートの底辺
                    const viewportBottomOnDocument = currentScrollY + window.innerHeight;
                    
                    // コンテナ内の配置Y座標 (画面の底に泡が出現するように逆算)
                    // Y位置 = (ビューポートの底) - (Deep Sea Areaの開始位置) - (泡コンテナの移動量: 負の値)
                    const baseSpawnY = viewportBottomOnDocument - areaStartOffset - moveY;

                    // 画面の底部周辺 (ビューポートの高さの20%の範囲) でランダムに生成
                    const spawnY = baseSpawnY + getRandom(0, window.innerHeight * 0.2); 
                    
                    // 泡を生成
                    createBubble(combinedBubbles, deepSeaArea.offsetHeight, spawnY); 
                    
                    // 画面外に出た泡の削除
                    removeOldBubbles(combinedBubbles);

                    lastGenerateScroll = currentScrollY;
                }
            }
        } 

        lastScrollY = currentScrollY;
    }

    // ページのロード後に初期化関数を実行
    window.addEventListener('load', () => {
        // Wrapperの高さが確定してから実行
        initializeBubbles(combinedBubbles, deepSeaArea);
        handleBubbleScroll(); // 初回実行
    });
    
    // スクロールイベントを登録
    window.addEventListener('scroll', handleBubbleScroll);
    
    // --- 【既存の処理】 ---

    // モーダル制御
    const triggers = document.querySelectorAll(".work-trigger, .work-image-trigger");
    const closeBtns = document.querySelectorAll(".close-modal-btn");

    triggers.forEach(trigger => {
        trigger.addEventListener("click", e => {
            e.preventDefault();
            const id = trigger.dataset.target;
            document.getElementById(id)?.classList.add("active");
            document.body.classList.add("no-scroll");
        });
    });

    closeBtns.forEach(btn => {
        btn.addEventListener("click", () => {
            btn.closest(".modal-overlay").classList.remove("active");
            document.body.classList.remove("no-scroll");
        });
    });

    // ナビゲーションの固定
    const nav = document.getElementById('nav-bar');
    const firstView = document.getElementById('home');

    window.addEventListener('scroll', () => {
        if (window.scrollY >= firstView.offsetHeight) {
            nav.classList.add('fixed');
        } else {
            nav.classList.remove('fixed');
        }
    });
    
});
</script>

</body>
</html>
